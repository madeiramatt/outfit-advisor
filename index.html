<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brantford Weather Outfit Advisor V2</title>
    <style>
        :root {
            /* Color system - creating shades with 0.1 lightness increments */
            /* Gray scale for depth */
            --bg-dark: hsl(220, 13%, 91%);
            --bg-base: hsl(220, 13%, 97%);
            --bg-light: hsl(220, 13%, 100%);

            /* Purple primary shades */
            --purple-dark: hsl(248, 73%, 50%);
            --purple-base: hsl(248, 73%, 60%);
            --purple-light: hsl(248, 73%, 70%);
            --purple-lighter: hsl(248, 73%, 80%);

            /* Blue shades for info */
            --blue-darker: hsl(217, 91%, 20%);
            --blue-dark: hsl(217, 91%, 30%);
            --blue-base: hsl(217, 91%, 60%);
            --blue-light: hsl(217, 91%, 95%);
            --blue-lighter: hsl(217, 91%, 97%);

            /* Green shades for success */
            --green-darker: hsl(158, 64%, 20%);
            --green-dark: hsl(158, 64%, 30%);
            --green-base: hsl(158, 64%, 50%);
            --green-light: hsl(158, 64%, 92%);
            --green-lighter: hsl(158, 64%, 95%);

            /* Amber shades for warning */
            --amber-darker: hsl(32, 95%, 20%);
            --amber-dark: hsl(32, 95%, 30%);
            --amber-base: hsl(32, 95%, 50%);
            --amber-light: hsl(32, 95%, 87%);
            --amber-lighter: hsl(32, 95%, 92%);

            /* Red shades for alerts */
            --red-darker: hsl(0, 84%, 20%);
            --red-dark: hsl(0, 84%, 30%);
            --red-base: hsl(0, 84%, 60%);
            --red-light: hsl(0, 84%, 95%);
            --red-lighter: hsl(0, 84%, 97%);

            /* Text colors */
            --text-primary: hsl(217, 19%, 15%);
            --text-secondary: hsl(217, 19%, 35%);
            --text-muted: hsl(217, 19%, 45%);

            /* Shadow system - combining light and dark shadows */
            --shadow-small:
                0 1px 2px 0 rgba(0, 0, 0, 0.05),
                0 -1px 0 0 rgba(255, 255, 255, 0.8) inset;

            --shadow-medium:
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06),
                0 -1px 0 0 rgba(255, 255, 255, 0.9) inset;

            --shadow-large:
                0 10px 15px -3px rgba(0, 0, 0, 0.1),
                0 4px 6px -2px rgba(0, 0, 0, 0.05),
                0 -2px 0 0 rgba(255, 255, 255, 0.95) inset;

            --shadow-inset-recessed:
                inset 0 2px 4px 0 rgba(0, 0, 0, 0.06),
                inset 0 -1px 0 0 rgba(255, 255, 255, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, var(--purple-base) 0%, var(--purple-dark) 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--bg-dark);
            border-radius: 16px;
            box-shadow:
                0 20px 60px rgba(0,0,0,0.15),
                0 10px 30px rgba(0,0,0,0.1),
                0 -2px 0 0 rgba(255, 255, 255, 0.1) inset;
            overflow: hidden;
        }

        header {
            background: linear-gradient(180deg, var(--purple-light) 0%, var(--purple-base) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            box-shadow:
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header p {
            opacity: 0.95;
            font-size: 14px;
        }
        
        .section {
            padding: 25px 30px;
            background: var(--bg-base);
            border-bottom: none;
        }

        .section:nth-child(odd) {
            background: var(--bg-light);
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }
        
        .temp-range {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, var(--bg-light) 0%, var(--bg-dark) 100%);
            padding: 20px 25px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-medium);
            transition: all 0.3s ease;
        }

        .temp-range:hover {
            box-shadow: var(--shadow-large);
            transform: translateY(-2px);
        }

        .temp-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .temp-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sun-adjustment {
            background: linear-gradient(180deg, var(--amber-lighter) 0%, var(--amber-light) 100%);
            padding: 12px 18px;
            border-radius: 8px;
            font-size: 14px;
            color: var(--amber-darker);
            margin-top: 10px;
            box-shadow: var(--shadow-small);
            border-left: 3px solid var(--amber-base);
        }
        
        .forecast-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 13px;
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-dark);
            box-shadow: var(--shadow-inset-recessed);
        }

        .forecast-table th {
            background: linear-gradient(180deg, var(--bg-base) 0%, var(--bg-dark) 100%);
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--bg-dark);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .forecast-table td {
            padding: 12px 10px;
            border-bottom: 1px solid var(--bg-base);
            color: var(--text-secondary);
            background: var(--bg-light);
        }

        .forecast-table tr:hover td {
            background: var(--bg-base);
            box-shadow: var(--shadow-small);
        }

        .forecast-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .current-conditions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .condition-card {
            background: linear-gradient(180deg, var(--bg-light) 0%, var(--bg-dark) 100%);
            padding: 18px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-medium);
            transition: all 0.3s ease;
        }

        .condition-card:hover {
            box-shadow: var(--shadow-large);
            transform: translateY(-3px);
        }

        .condition-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .condition-value {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .layers-list {
            list-style: none;
            margin-top: 15px;
        }

        .layers-list li {
            padding: 14px 18px;
            background: linear-gradient(180deg, var(--blue-lighter) 0%, var(--blue-light) 100%);
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid var(--blue-base);
            color: var(--blue-darker);
            font-weight: 500;
            box-shadow: var(--shadow-small);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .layers-list li::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
        }

        .layers-list li:hover {
            box-shadow: var(--shadow-medium);
            transform: translateX(4px);
        }

        .no-additional {
            padding: 14px 18px;
            background: linear-gradient(180deg, var(--green-lighter) 0%, var(--green-light) 100%);
            border-radius: 8px;
            border-left: 4px solid var(--green-base);
            color: var(--green-darker);
            font-weight: 500;
            margin-top: 15px;
            box-shadow: var(--shadow-small);
            position: relative;
            overflow: hidden;
        }

        .no-additional::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
        }
        
        .protection-box {
            background: linear-gradient(180deg, var(--red-lighter) 0%, var(--red-light) 100%);
            border: none;
            border-radius: 10px;
            padding: 18px 20px;
            margin-top: 15px;
            box-shadow: var(--shadow-medium);
            border-left: 4px solid var(--red-base);
            position: relative;
            overflow: hidden;
        }

        .protection-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
        }

        .protection-box.wind {
            background: linear-gradient(180deg, var(--blue-lighter) 0%, var(--blue-light) 100%);
            border-left-color: var(--blue-base);
        }

        .protection-title {
            font-weight: 600;
            color: var(--red-darker);
            margin-bottom: 12px;
            font-size: 15px;
        }

        .protection-box.wind .protection-title {
            color: var(--blue-darker);
        }

        .protection-item {
            padding: 6px 0;
            color: var(--red-dark);
            padding-left: 4px;
        }

        .protection-box.wind .protection-item {
            color: var(--blue-dark);
        }
        
        .intensity-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-right: 8px;
            box-shadow: var(--shadow-small);
            position: relative;
            overflow: hidden;
        }

        .intensity-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
        }

        .intensity-light {
            background: linear-gradient(180deg, var(--amber-lighter) 0%, var(--amber-light) 100%);
            color: var(--amber-darker);
        }

        .intensity-moderate {
            background: linear-gradient(180deg, hsl(32, 95%, 90%) 0%, hsl(32, 95%, 83%) 100%);
            color: var(--amber-darker);
        }

        .intensity-heavy {
            background: linear-gradient(180deg, hsl(0, 84%, 93%) 0%, hsl(0, 84%, 88%) 100%);
            color: var(--red-darker);
        }
        
        .last-updated {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-size: 14px;
        }

        .error {
            background: linear-gradient(180deg, var(--red-lighter) 0%, var(--red-light) 100%);
            border: none;
            border-radius: 10px;
            padding: 20px 25px;
            margin: 20px 30px;
            color: var(--red-darker);
            box-shadow: var(--shadow-medium);
            border-left: 4px solid var(--red-base);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Brantford Weather Outfit Advisor</h1>
            <p>Learn to layer properly for today's conditions</p>
        </header>
        <div id="app">
            <div class="loading">Loading weather data...</div>
        </div>
    </div>

    <script>
        const BRANTFORD_LAT = 43.1394;
        const BRANTFORD_LON = -80.2644;
        const WAKING_HOURS_START = 6;
        const WAKING_HOURS_END = 23;
        const UV_TEMP_ADJUSTMENT = 0.72;
        const WIND_THRESHOLD = 15;
        const HUMID_THRESHOLD = 60;
        const VEST_TEMP_THRESHOLD = 10;

        const ECWCS_LAYERS = {
            0: "Level 0: Moisture-wicking underwear",
            1: "Level I: Lightweight base layer",
            2: "Level II: Mid-weight base layer",
            3: "Level III: High-loft fleece jacket",
            5: "Level V: Soft shell jacket",
            6: "Level VI: GORE-TEX wet/cold weather gear",
            7: "Level VII: Extreme cold parka"
        };

        async function fetchWeatherData() {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${BRANTFORD_LAT}&longitude=${BRANTFORD_LON}&current=apparent_temperature,wind_speed_10m,precipitation&hourly=apparent_temperature,precipitation_probability,precipitation,snowfall,wind_speed_10m,uv_index,is_day,relative_humidity_2m&timezone=America%2FToronto&forecast_days=1`;
            
            const response = await fetch(url);
            if (!response.ok) throw new Error('Weather data unavailable');
            return await response.json();
        }

        function getApparentTempWithSun(apparentTemp, uvIndex, isDay) {
            if (!isDay || uvIndex <= 0) return { temp: apparentTemp, sunAdjustment: 0 };
            const sunAdjustment = uvIndex * UV_TEMP_ADJUSTMENT;
            return { temp: apparentTemp + sunAdjustment, sunAdjustment };
        }

        function getLayersForTemp(apparentTemp) {
            const layers = [];
            
            if (apparentTemp > 0) layers.push(0);
            
            if (apparentTemp <= 30 && apparentTemp > 20) {
                // No additional layers
            } else if (apparentTemp <= 20 && apparentTemp > 15) {
                layers.push(1);
            } else if (apparentTemp <= 15 && apparentTemp > 10) {
                layers.push(1, 3);
            } else if (apparentTemp <= 10 && apparentTemp > 5) {
                layers.push(1, 2, 3);
            } else if (apparentTemp <= 5 && apparentTemp > 0) {
                layers.push(1, 2, 3, 5);
            } else if (apparentTemp <= 0 && apparentTemp > -10) {
                layers.push(1, 2, 3, 5, 6);
            } else if (apparentTemp <= -10 && apparentTemp > -20) {
                layers.push(1, 2, 3, 6, 7);
            } else if (apparentTemp <= -20) {
                layers.push(1, 2, 3, 6, 7);
            }
            
            return layers;
        }

        function getRainProtection(precipMm) {
            if (precipMm <= 0) return null;
            
            if (precipMm < 5) {
                return {
                    intensity: 'light',
                    label: 'Light',
                    items: ['Rain jacket or umbrella']
                };
            } else if (precipMm < 15) {
                return {
                    intensity: 'moderate',
                    label: 'Moderate',
                    items: ['Rain jacket', 'Consider rain trousers']
                };
            } else {
                return {
                    intensity: 'heavy',
                    label: 'Heavy',
                    items: ['Full rain gear', 'Waterproof footwear', 'Rain trousers']
                };
            }
        }

        function getWindProtection(windSpeed, humidity, temp) {
            if (windSpeed <= WIND_THRESHOLD) return null;
            
            const items = [];
            
            if (humidity > HUMID_THRESHOLD && temp > VEST_TEMP_THRESHOLD) {
                items.push('Vest (humid conditions)');
            } else if (windSpeed > 30) {
                items.push('Level IV wind shell');
            } else {
                items.push('Windbreaker');
            }
            
            if (windSpeed > 40) {
                items.push('Face protection recommended');
            }
            
            return {
                intensity: windSpeed > 30 ? 'moderate' : 'light',
                label: windSpeed > 30 ? 'Strong' : 'Moderate',
                items
            };
        }

        function renderApp(data) {
            const now = new Date();
            const currentHour = now.getHours();
            
            // Find current hour index and next 3 hours
            const hourlyData = data.hourly;
            const currentIndex = hourlyData.time.findIndex(t => {
                const hour = new Date(t).getHours();
                return hour === currentHour;
            });
            
            // Get waking hours data (6-23)
            const wakingHoursData = hourlyData.time.map((time, i) => {
                const hour = new Date(time).getHours();
                if (hour >= WAKING_HOURS_START && hour <= WAKING_HOURS_END) {
                    return {
                        apparentTemp: hourlyData.apparent_temperature[i],
                        uvIndex: hourlyData.uv_index[i],
                        isDay: hourlyData.is_day[i] === 1,
                        humidity: hourlyData.relative_humidity_2m[i],
                        windSpeed: hourlyData.wind_speed_10m[i],
                        precipitation: (hourlyData.precipitation[i] || 0) + (hourlyData.snowfall[i] || 0)
                    };
                }
                return null;
            }).filter(d => d !== null);
            
            // Calculate worst-case for day
            const apparentTemps = wakingHoursData.map(d => d.apparentTemp);
            const minTemp = Math.min(...apparentTemps);
            const maxTemp = Math.max(...apparentTemps);
            
            // Find max UV during day
            const maxUV = Math.max(...wakingHoursData.filter(d => d.isDay).map(d => d.uvIndex || 0));
            const maxSunAdjustment = maxUV > 0 ? maxUV * UV_TEMP_ADJUSTMENT : 0;
            
            // Current conditions
            const current = {
                apparentTemp: data.current.apparent_temperature,
                windSpeed: data.current.wind_speed_10m,
                precipitation: data.current.precipitation || 0,
                uvIndex: hourlyData.uv_index[currentIndex] || 0,
                isDay: hourlyData.is_day[currentIndex] === 1,
                humidity: hourlyData.relative_humidity_2m[currentIndex]
            };
            
            const currentWithSun = getApparentTempWithSun(current.apparentTemp, current.uvIndex, current.isDay);
            
            // Next 3 hours forecast
            const next3Hours = [];
            for (let i = 0; i < 3; i++) {
                const idx = currentIndex + i;
                if (idx < hourlyData.time.length) {
                    const time = new Date(hourlyData.time[idx]);
                    const isDay = hourlyData.is_day[idx] === 1;
                    const uvIndex = hourlyData.uv_index[idx] || 0;
                    const apparentTemp = hourlyData.apparent_temperature[idx];
                    const withSun = getApparentTempWithSun(apparentTemp, uvIndex, isDay);
                    
                    next3Hours.push({
                        time: time.getHours() + ':00',
                        apparentTemp: apparentTemp.toFixed(1),
                        inSunTemp: isDay && uvIndex > 0 ? withSun.temp.toFixed(1) : '-',
                        precipProb: hourlyData.precipitation_probability[idx] || 0,
                        precipMm: ((hourlyData.precipitation[idx] || 0) + (hourlyData.snowfall[idx] || 0)).toFixed(1),
                        windSpeed: hourlyData.wind_speed_10m[idx].toFixed(0),
                        uvIndex: uvIndex.toFixed(0)
                    });
                }
            }
            
            // Layer calculations
            const currentLayers = getLayersForTemp(current.apparentTemp);
            const worstCaseLayers = getLayersForTemp(minTemp);
            const additionalLayers = worstCaseLayers.filter(l => !currentLayers.includes(l));
            
            // Protection
            const maxPrecip = Math.max(...wakingHoursData.map(d => d.precipitation));
            const maxWind = Math.max(...wakingHoursData.map(d => d.windSpeed));
            const rainProtection = getRainProtection(maxPrecip);
            const windProtection = rainProtection ? null : getWindProtection(maxWind, current.humidity, current.apparentTemp);
            
            // Render HTML
            let html = `
                <div class="section">
                    <h2 class="section-title">Today's Overview (6:00 - 23:00)</h2>
                    <div class="temp-range">
                        <div>
                            <div class="temp-label">Minimum</div>
                            <div class="temp-value">${minTemp.toFixed(1)}°C</div>
                        </div>
                        <div>
                            <div class="temp-label">Maximum</div>
                            <div class="temp-value">${maxTemp.toFixed(1)}°C</div>
                        </div>
                    </div>
                    ${maxSunAdjustment > 0 ? `
                        <div class="sun-adjustment">
                            ☀️ In sun: up to +${maxSunAdjustment.toFixed(1)}°C warmer (max ${(maxTemp + maxSunAdjustment).toFixed(1)}°C)
                        </div>
                    ` : ''}
                </div>
                
                <div class="section">
                    <h2 class="section-title">Next 3 Hours Forecast</h2>
                    <table class="forecast-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Temp</th>
                                <th>In Sun</th>
                                <th>Precip %</th>
                                <th>Precip mm</th>
                                <th>Wind</th>
                                <th>UV</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${next3Hours.map(h => `
                                <tr>
                                    <td>${h.time}</td>
                                    <td>${h.apparentTemp}°C</td>
                                    <td>${h.inSunTemp !== '-' ? h.inSunTemp + '°C' : '-'}</td>
                                    <td>${h.precipProb}%</td>
                                    <td>${h.precipMm}</td>
                                    <td>${h.windSpeed} km/h</td>
                                    <td>${h.uvIndex}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="section">
                    <h2 class="section-title">Next Hour Overview</h2>
                    <div class="current-conditions">
                        <div class="condition-card">
                            <div class="condition-label">Apparent Temperature</div>
                            <div class="condition-value">${current.apparentTemp.toFixed(1)}°C</div>
                        </div>
                        ${currentWithSun.sunAdjustment > 0 ? `
                            <div class="condition-card">
                                <div class="condition-label">In Sun</div>
                                <div class="condition-value">${currentWithSun.temp.toFixed(1)}°C</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">Layers for Next Hour</h2>
                    <ul class="layers-list">
                        ${currentLayers.map(l => `<li>${ECWCS_LAYERS[l]}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="section">
                    <h2 class="section-title">Additional Layers for Full Day</h2>
                    ${additionalLayers.length > 0 ? `
                        <ul class="layers-list">
                            ${additionalLayers.map(l => `<li>${ECWCS_LAYERS[l]}</li>`).join('')}
                        </ul>
                    ` : `
                        <div class="no-additional">✓ No additional layers needed for today</div>
                    `}
                </div>
                
                ${rainProtection ? `
                    <div class="section">
                        <h2 class="section-title">Rain Protection</h2>
                        <div class="protection-box">
                            <div class="protection-title">
                                <span class="intensity-badge intensity-${rainProtection.intensity}">${rainProtection.label}</span>
                                Precipitation Expected
                            </div>
                            ${rainProtection.items.map(item => `<div class="protection-item">• ${item}</div>`).join('')}
                        </div>
                    </div>
                ` : ''}
                
                ${windProtection ? `
                    <div class="section">
                        <h2 class="section-title">Wind Protection</h2>
                        <div class="protection-box wind">
                            <div class="protection-title">
                                <span class="intensity-badge intensity-${windProtection.intensity}">${windProtection.label}</span>
                                Wind Conditions
                            </div>
                            ${windProtection.items.map(item => `<div class="protection-item">• ${item}</div>`).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div class="last-updated">
                    Last updated: ${now.toLocaleTimeString('en-CA', { hour: '2-digit', minute: '2-digit' })}
                </div>
            `;
            
            document.getElementById('app').innerHTML = html;
        }

        async function init() {
            try {
                const data = await fetchWeatherData();
                renderApp(data);
                
                // Update every hour
                setInterval(async () => {
                    const data = await fetchWeatherData();
                    renderApp(data);
                }, 3600000);
            } catch (error) {
                document.getElementById('app').innerHTML = `
                    <div class="error">
                        <strong>Error loading weather data</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        init();
    </script>
</body>
</html>
