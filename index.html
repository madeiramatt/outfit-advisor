<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brantford Outfit Advisor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .location {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .weather-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .temp-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .temp-item {
            text-align: center;
        }
        
        .temp-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .temp-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .recommendation {
            background: #667eea;
            color: white;
            padding: 25px;
            border-radius: 10px;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .recommendation-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .last-update {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
            color: #999;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-size: 18px;
        }
        
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>What Should I Wear?</h1>
        <div class="location">Brantford, Ontario, Canada</div>
        
        <div id="content">
            <div class="loading">Loading weather data...</div>
        </div>
        
        <div class="last-update" id="lastUpdate"></div>
    </div>

    <script>
        const LATITUDE = 43.1394;
        const LONGITUDE = -80.2644;
        const API_URL = `https://api.open-meteo.com/v1/forecast?latitude=${LATITUDE}&longitude=${LONGITUDE}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max&hourly=temperature_2m,relative_humidity_2m,wind_speed_10m,precipitation&timezone=America/Toronto&forecast_days=1`;
        
        const outfitTable = {
            '-30': {
                '0-5': 'Level I + Level II base layers, Level III fleece, Level VII parka and trousers, balaclava, insulated gloves and boots',
                '5-10': 'Level I + Level II base layers, Level VII parka and trousers, removable Level III fleece, balaclava, insulated gloves',
                '10+': 'Level I base layer, Level II mid-layer, Level VII parka, removable Level III fleece option, face protection and insulated gloves'
            },
            '-20': {
                '0-5': 'Level I + Level II base layers, Level III fleece, Level V soft shell jacket and trousers, balaclava, insulated gloves',
                '5-10': 'Level I + Level II base layers, Level V soft shell, removable Level III fleece, face covering, insulated gloves',
                '10+': 'Level I base layer, Level V soft shell jacket, removable Level II or Level III underneath, warm accessories'
            },
            '-15': {
                '0-5': 'Level II base layer, Level III fleece, Level V soft shell jacket and trousers, hat, insulated gloves',
                '5-10': 'Level II base layer, Level V soft shell, removable Level III fleece, winter accessories',
                '10+': 'Level I base layer, Level V soft shell, removable Level III fleece option, hat and gloves'
            },
            '-10': {
                '0-5': 'Level II base layer, Level III fleece, Level V soft shell jacket, hat, gloves',
                '5-10': 'Level II base layer, Level V soft shell, removable Level III fleece, warm accessories',
                '10+': 'Level I base layer, Level V soft shell, removable Level III fleece, winter accessories'
            },
            '-5': {
                '0-5': 'Level II base layer, Level III fleece, Level V soft shell jacket, hat, gloves',
                '5-10': 'Level II base layer, Level III fleece with removable Level V soft shell, warm accessories',
                '10+': 'Level I base layer, Level III fleece, removable Level V soft shell option'
            },
            '0': {
                '0-5': 'Level 0 or Level II base layer, Level III fleece jacket, closed shoes',
                '5-10': 'Level 0 or Level II base layer, Level III fleece with removable layer option, long pants',
                '10+': 'Level 0 or Level I base layer, Level III fleece, removable under-layer'
            },
            '5': {
                '0-5': 'Level 0 base layer, Level III fleece or heavy jacket, closed shoes',
                '5-10': 'Level 0 base layer, Level III fleece with removable option, long pants',
                '10+': 'Level 0 base layer, Level III fleece with removable under-layer'
            },
            '10': {
                '0-5': 'Level 0 base layer, Level III fleece or light jacket, long pants',
                '5-10': 'Level 0 base layer, light jacket with removable layer, pants',
                '10+': 'Level 0 base layer, light jacket with removable option, pants'
            },
            '15': {
                '0-5': 'Level 0 base layer, long-sleeve shirt or light sweater, pants',
                '5-10': 'Level 0 base layer, long-sleeve shirt with removable layer, pants',
                '10+': 'Level 0 base layer, hoodie or light jacket over t-shirt, pants'
            },
            '20': {
                '0-5': 'Level 0 base layer, long-sleeve shirt or t-shirt, pants',
                '5-10': 'Level 0 base layer, t-shirt with thin overshirt option, pants',
                '10+': 'Level 0 base layer, t-shirt with light cardigan option, pants or jeans'
            },
            '25': {
                '0-5': 'Level 0 base layer, t-shirt, light pants or shorts',
                '5-10': 'Level 0 base layer, t-shirt with optional thin layer, light pants or shorts',
                '10+': 'Level 0 base layer, t-shirt, bring thin layer for temperature changes'
            },
            '30': {
                '0-5': 'Level 0 base layer, t-shirt, shorts',
                '5-10': 'Level 0 base layer, t-shirt, shorts, optional sun layer',
                '10+': 'Level 0 base layer, t-shirt, shorts, light layer for morning only'
            }
        };

        function getTempCategory(temp) {
            if (temp < -20) return '-30';
            if (temp < -15) return '-20';
            if (temp < -10) return '-15';
            if (temp < -5) return '-10';
            if (temp < 0) return '-5';
            if (temp < 5) return '0';
            if (temp < 10) return '5';
            if (temp < 15) return '10';
            if (temp < 20) return '15';
            if (temp < 25) return '20';
            if (temp < 30) return '25';
            return '30';
        }

        function getRangeCategory(range) {
            if (range < 5) return '0-5';
            if (range <= 10) return '5-10';
            return '10+';
        }

        function getOutfitRecommendation(maxTemp, minTemp) {
            const range = maxTemp - minTemp;
            const tempCat = getTempCategory(maxTemp);
            const rangeCat = getRangeCategory(range);
            
            return outfitTable[tempCat][rangeCat];
        }

        function getRainGear(precipMm, precipProb) {
            if (precipMm === 0 || precipProb < 30) {
                return null;
            }
            
            if (precipMm < 5) {
                return {
                    intensity: 'Light rain expected',
                    gear: 'Rain jacket or umbrella'
                };
            } else if (precipMm < 15) {
                return {
                    intensity: 'Moderate rain expected',
                    gear: 'Rain jacket and consider rain pants'
                };
            } else {
                return {
                    intensity: 'Heavy rain expected',
                    gear: 'Rain jacket, rain pants, waterproof footwear'
                };
            }
        }

        function getWindGear(windSpeedKmh, avgHumidity, avgTempC) {
            if (windSpeedKmh < 15) {
                return null;
            }
            
            const preferVest = avgHumidity > 60 && avgTempC > 10;
            
            if (windSpeedKmh < 25) {
                return {
                    intensity: `Moderate wind (${Math.round(windSpeedKmh)} km/h)`,
                    gear: preferVest ? 'Light vest recommended for wind protection' : 'Light windbreaker or long sleeves'
                };
            } else if (windSpeedKmh < 40) {
                return {
                    intensity: `Strong wind (${Math.round(windSpeedKmh)} km/h)`,
                    gear: preferVest ? 'Insulated vest with wind-resistant fabric' : 'Wind jacket or Level 4 wind shell'
                };
            } else {
                return {
                    intensity: `Very strong wind (${Math.round(windSpeedKmh)} km/h)`,
                    gear: 'Level 4 wind shell or heavy windbreaker required'
                };
            }
        }

        function calculateApparentTemp(tempC, relativeHumidity, windSpeedMs) {
            const e = (relativeHumidity / 100) * 6.105 * Math.exp((17.27 * tempC) / (237.7 + tempC));
            const AT = tempC + (0.33 * e) - (0.70 * windSpeedMs) - 4.00;
            return Math.round(AT * 10) / 10;
        }

        function getCurrentHourIndex(hourlyTimes) {
            const now = new Date();
            const currentHour = now.getHours();
            
            for (let i = 0; i < hourlyTimes.length; i++) {
                const hourDate = new Date(hourlyTimes[i]);
                if (hourDate.getHours() === currentHour && hourDate.getDate() === now.getDate()) {
                    return i;
                }
            }
            return 0;
        }

        async function fetchWeather() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Weather data unavailable');
                
                const data = await response.json();
                
                const precipMm = data.daily.precipitation_sum[0] || 0;
                const precipProb = data.daily.precipitation_probability_max[0] || 0;
                
                // Filter hourly data for waking hours (06:00 to 23:00)
                const wakingHourIndices = [];
                for (let i = 0; i < data.hourly.time.length; i++) {
                    const hourDate = new Date(data.hourly.time[i]);
                    const hour = hourDate.getHours();
                    if (hour >= 6 && hour <= 23) {
                        wakingHourIndices.push(i);
                    }
                }
                
                // Calculate apparent temps for all waking hours
                const wakingApparentTemps = wakingHourIndices.map(i => {
                    return {
                        index: i,
                        apparent: calculateApparentTemp(
                            data.hourly.temperature_2m[i],
                            data.hourly.relative_humidity_2m[i],
                            data.hourly.wind_speed_10m[i] * 0.277778
                        ),
                        windSpeed: data.hourly.wind_speed_10m[i],
                        humidity: data.hourly.relative_humidity_2m[i],
                        temp: data.hourly.temperature_2m[i]
                    };
                });
                
                // Find min and max apparent temps during waking hours
                const minApparentData = wakingApparentTemps.reduce((min, curr) => 
                    curr.apparent < min.apparent ? curr : min
                );
                const maxApparentData = wakingApparentTemps.reduce((max, curr) => 
                    curr.apparent > max.apparent ? curr : max
                );
                
                const minApparentTemp = minApparentData.apparent;
                const maxApparentTemp = maxApparentData.apparent;
                
                // Calculate average wind speed, humidity, and temp for waking hours
                const avgWindSpeed = wakingApparentTemps.reduce((sum, curr) => sum + curr.windSpeed, 0) / wakingApparentTemps.length;
                const avgHumidity = wakingApparentTemps.reduce((sum, curr) => sum + curr.humidity, 0) / wakingApparentTemps.length;
                const avgTemp = wakingApparentTemps.reduce((sum, curr) => sum + curr.temp, 0) / wakingApparentTemps.length;
                
                // Next hour data
                const currentHourIndex = getCurrentHourIndex(data.hourly.time);
                const nextHourIndex = Math.min(currentHourIndex + 1, data.hourly.time.length - 1);
                
                const nextHourTemp = Math.round(data.hourly.temperature_2m[nextHourIndex]);
                const nextHourHumidity = data.hourly.relative_humidity_2m[nextHourIndex];
                const nextHourWindSpeed = data.hourly.wind_speed_10m[nextHourIndex];
                const nextHourPrecip = data.hourly.precipitation[nextHourIndex] || 0;
                
                // Calculate apparent temperature for next hour
                const apparentTemp = calculateApparentTemp(
                    data.hourly.temperature_2m[nextHourIndex],
                    nextHourHumidity,
                    nextHourWindSpeed * 0.277778
                );
                
                const dayRecommendation = getOutfitRecommendation(Math.round(maxApparentTemp), Math.round(minApparentTemp));
                const hourRecommendation = getOutfitRecommendation(nextHourTemp, nextHourTemp);
                const rainGear = getRainGear(precipMm, precipProb);
                const windGear = getWindGear(avgWindSpeed, avgHumidity, avgTemp);
                
                displayWeather(
                    minApparentTemp, maxApparentTemp, dayRecommendation,
                    apparentTemp, hourRecommendation,
                    rainGear, precipMm, precipProb, nextHourPrecip,
                    windGear
                );
                updateLastUpdateTime();
            } catch (error) {
                displayError('Unable to fetch weather data. Please try again later.');
            }
        }

        function displayWeather(minApparentTemp, maxApparentTemp, dayRecommendation, apparentTemp, hourRecommendation, rainGear, precipMm, precipProb, nextHourPrecip, windGear) {
            const apparentRange = maxApparentTemp - minApparentTemp;
            
            let rainSection = '';
            if (rainGear) {
                rainSection = `
                    <div class="recommendation" style="background: #4a90e2; margin-top: 15px;">
                        <div class="recommendation-title">Rain Protection (Today)</div>
                        <div style="margin-bottom: 8px;">${rainGear.intensity} (${precipMm}mm, ${precipProb}% chance)</div>
                        <div>${rainGear.gear}</div>
                    </div>
                `;
            }
            
            let windSection = '';
            if (windGear) {
                windSection = `
                    <div class="recommendation" style="background: #16a085; margin-top: 15px;">
                        <div class="recommendation-title">Wind Protection (Today)</div>
                        <div style="margin-bottom: 8px;">${windGear.intensity}</div>
                        <div>${windGear.gear}</div>
                    </div>
                `;
            }
            
            let nextHourRain = '';
            if (nextHourPrecip > 0) {
                nextHourRain = `<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3);"><strong>Rain alert:</strong> ${nextHourPrecip.toFixed(1)}mm expected in next hour</div>`;
            }
            
            document.getElementById('content').innerHTML = `
                <div class="weather-info">
                    <div style="font-weight: bold; margin-bottom: 15px; color: #333; font-size: 16px;">Today's Overview (06:00-23:00)</div>
                    <div class="temp-display">
                        <div class="temp-item">
                            <div class="temp-label">Min</div>
                            <div class="temp-value">${minApparentTemp.toFixed(1)}째C</div>
                        </div>
                        <div class="temp-item">
                            <div class="temp-label">Max</div>
                            <div class="temp-value">${maxApparentTemp.toFixed(1)}째C</div>
                        </div>
                        <div class="temp-item">
                            <div class="temp-label">Range</div>
                            <div class="temp-value">${apparentRange.toFixed(1)}째C</div>
                        </div>
                    </div>
                </div>
                <div class="recommendation">
                    <div class="recommendation-title">Today's Base Outfit</div>
                    ${dayRecommendation}
                </div>
                ${rainSection}
                ${windSection}
                <div class="recommendation" style="background: #e67e22; margin-top: 15px;">
                    <div class="recommendation-title">Next Hour (Right Now)</div>
                    <div style="margin-bottom: 10px;">
                        <strong>Temperature:</strong> ${apparentTemp.toFixed(1)}째C
                    </div>
                    <div>${hourRecommendation}</div>
                    ${nextHourRain}
                </div>
            `;
        }

        function displayError(message) {
            document.getElementById('content').innerHTML = `
                <div class="error">${message}</div>
            `;
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-CA', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            document.getElementById('lastUpdate').textContent = `Last updated: ${timeString}`;
        }

        fetchWeather();
        setInterval(fetchWeather, 3600000);
    </script>
</body>
</html>
